#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

if $(git diff --name-only --cached | grep -q '^pnpm-lock.yaml$'); then
  rm pnpm-lock.yaml
  pnpm i
fi

for ws in $(git diff --name-only --cached | grep -oE 'packages/([^/]+)' | uniq); do
  pnpm --filter="./${ws}" lint:fix
done

git rm -f --ignore-unmatch packages/packages
